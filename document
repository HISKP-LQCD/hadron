#!/bin/bash

set -e
set -u

autoreconf -vif

# XXX: Starting with Roxygen version 7.1.0 or some version or Rcpp there is a
# circular dependency on the `NAMESPACE` file. Roxygen will call
# `Rcpp::compileAttributes()` which needs the `NAMESPACE`, which does not exist
# at this point. The hack is to just generate this file without any content but
# with the marker such that Roxygen will overwrite it with the actual output.
if ! [[ -f NAMESPACE ]]; then
  echo '# Generated by roxygen2: do not edit by hand' > NAMESPACE
fi

Rscript -e "devtools::document()"
